chrome.runtime.onInstalled.addListener((()=>{console.log("Extension installed"),chrome.declarativeNetRequest.updateDynamicRules({removeRuleIds:[1],addRules:[{id:1,priority:1,action:{type:"block"},condition:{urlFilter:"https://www.google.com/maps/*",resourceTypes:["main_frame"]}}]},(()=>{chrome.runtime.lastError?console.error("Error updating rules:",chrome.runtime.lastError.message):console.log("Rules updated successfully")}))}));const openGoogleMaps=async()=>{const e=await chrome.tabs.query({url:"https://www.google.com/maps/*"});return e.length>0?(chrome.tabs.update(e[0].id,{active:!0}),e[0]):new Promise((e=>{chrome.tabs.create({url:"https://www.google.com/maps"},(o=>{console.log("Opened Google Maps:",o),e(o)}))}))},injectContentScript=(e,o)=>{chrome.scripting.executeScript({target:{tabId:e},files:["content.js"]},(()=>{chrome.runtime.lastError?console.error("Error injecting content script:",chrome.runtime.lastError.message):(console.log("Content script injected successfully!"),o&&o())}))},checkContentScriptReady=(e,o)=>{chrome.tabs.sendMessage(e,{type:"PING"},(r=>{chrome.runtime.lastError?(console.warn("Content script not ready:",chrome.runtime.lastError.message),injectContentScript(e,(()=>checkContentScriptReady(e,o)))):r&&"READY"===r.status&&(console.log("Content script is ready!"),o())}))},openAndPrepareGoogleMaps=async()=>{const e=await openGoogleMaps();checkContentScriptReady(e.id,(()=>{console.log("Google Maps and content script are ready!")}))};chrome.runtime.onMessage.addListener(((e,o,r)=>"OPEN_GOOGLE_MAPS"===e.type?(openAndPrepareGoogleMaps().then((()=>r({success:!0}))),!0):"ADD_MARKERS"===e.type?(chrome.tabs.query({url:"https://www.google.com/maps/*"},(o=>{if(o.length>0){const r=o[0].id;checkContentScriptReady(r,(()=>{chrome.tabs.sendMessage(r,{type:"RECEIVE_HOUSE_DATA",payload:e.payload},(e=>{chrome.runtime.lastError?console.error("Error sending markers:",chrome.runtime.lastError.message):console.log("Markers sent successfully:",e)}))}))}else console.error("No Google Maps tab found!")})),r({success:!0}),!0):void 0));